;  [global/wm]
; include-file = $HOME/.config/polybar/catppuccin/themes/mocha.ini

[bar/main]
; monitor = ${env:MONITOR:}
monitor = eDP
width = 100%
height = 16pt
offset-x = 0%
radius = 0

; dpi = 96

background = ${colors.background}
foreground = ${colors.foreground}

line-size = 3pt

border-size = 0pt
border-color = #00000000

padding-left = 2.5
padding-right = 1

module-margin = 1

separator = " " 
separator-foreground = ${colors.disabled}

font-0 = "Hack Nerd Font:style=Medium:size=10.5;2"
font-1 = "Hack:style=Medium:size=6"
; modules-left = cava xmonad
; modules-center = espr date timer ; TODO: Fix
modules-left = xmonad windowtitle
modules-center = date
modules-right = wifi eth pulseaudio memory system-nvidia-smi cpu battery powermenu

tray-position = left
tray-background = #45475a
tray-padding = 10pt

cursor-click = pointer
cursor-scroll = ns-resize

enable-ipc = true

; MOVED: See home.nix
; [module/xmonad]
; type = custom/script
; exec = /run/current-system/sw/bin/xmonad-log # Uses [https://github.com/xintron/xmonad-log] to comm. with xmonad

; tail = true

[module/windowtitle]
type = "internal/xwindow"

format = "<label>"
format-foreground = ""
format-padding = 0

label = "%title:0:40: Ó©º %"

label-maxlen = 60
label-empty = ""

[module/ewmh]
type = internal/xworkspaces

group-by-monitor = false
label-monitor = "| "

enable-click = true
; enable-scroll = true
; reverse-scroll = true

; icon-[0-9]+ = <desktop-name>;<icon>
; Map desktop names to some icon. The icon is then available in the %icon% token
; NOTE: The desktop name needs to match the name configured by the WM
; You can get a list of the defined desktop names using:
; $ xprop -root _NET_DESKTOP_NAMES
icon-0 = "1;Ó´Ñ "
icon-1 = "office;Û∞àô "
icon-2 = "graphics;Û∞†± "
icon-3 = "mail;ÔêØ "
icon-4 = "web;Û∞ñü "
icon-default = ""

format = <label-state> <label-monitor>

; Tokens: %name%, %icon%, %index%, %nwin%
label-active = %icon%%name%
label-active-foreground = "#cdd6f4"
label-active-underline = "#f43e5c"
label-active-padding = 1

; Workspaces with at least one window
; Tokens: %name%, %icon%, %index%, %nwin%
label-occupied = %icon%%name%
label-occupied-underline = "#45475a"
label-occupied-padding = 1

; Workspaces with no windows
label-empty = ""
label-empty-padding = 0

; Workspaces with a window that has the urgent bit set
label-urgent = %icon%%name%
label-urgent-foreground = "#11111b"
label-urgent-background = "#f38ba8"
label-urgent-underline = "#f43e5c"
label-urgent-padding = 1


[module/xworkspaces]
type = internal/xworkspaces

label-active = %name%
label-active-background = ${colors.background-alt}
label-active-underline= ${colors.primary}
label-active-padding = 1

label-occupied = %name%
label-occupied-padding = 1

label-urgent = %name%
label-urgent-background = ${colors.alert}
label-urgent-padding = 1

label-empty = %name%
label-empty-foreground = ${colors.disabled}
label-empty-padding = 1

[module/xwindow]
type = internal/xwindow
label = %title:0:60:...%

[module/filesystem]
type = internal/fs
interval = 25

mount-0 = /

label-mounted = Ôüâ  %percentage_used%%

label-unmounted = %mountpoint% not mounted
label-unmounted-foreground = ${colors.disabled}

[module/pulseaudio]
type = internal/pulseaudio

format-volume-prefix = "Û∞ïæ "
format-volume-prefix-foreground = ${colors.peach}
format-volume =  <label-volume>

label-volume =  %percentage%%

label-muted = Ôë¶
label-muted-foreground = ${colors.disabled}

[module/xkeyboard]
type = internal/xkeyboard
blacklist-0 = num lock

label-layout = %layout%
label-layout-foreground = ${colors.primary}

label-indicator-padding = MUTED
label-indicator-margin = 1
label-indicator-foreground = ${colors.background}
label-indicator-background = ${colors.secondary}

[module/memory]
type = internal/memory
interval = 2
format-prefix = "Óâ¶ "
format-prefix-foreground = ${colors.green}
label = %percentage_used:2%%

[module/cpu]
type = internal/cpu
interval = 5
format-prefix = "Û∞öó "
format-prefix-foreground = ${colors.blue}
label = %percentage:2%%

[module/system-nvidia-smi]
type = custom/script
format-prefix = "Û∞û£ "
format-prefix-foreground = "${colors.red}"
exec = /run/current-system/sw/bin/nvidia-smi --query-gpu=utilization.gpu --format=csv,noheader,nounits | /run/current-system/sw/bin/awk '{print $1"%"}'
interval = 5

[module/eth]
type = internal/network
interface = enp2s0
interface-type = wired
interval = 5

[module/wifi]
type = internal/network
itreuenterface = wlp3s0
interface-type = wireless
interval = 5

format-connected = <ramp-signal>  <label-connected>
format-disconnected = Û∞§Æ  <label-disconnected>
format-packetloss = <animation-packetloss> <label-connected>

; Other options: %downspeed:9% %ifname% %local_ip%
; label-connected = %{A1:nm-applet:}Ôá´  %essid%%{A}
label-connected = %essid%
label-connected-foreground = ${colors.teal}
label-disconnected = disconnected
label-disconnected-foreground = ${colors.subtext1}
label-packetloss = %essid%
label-packetloss-foreground = ${colors.rosewater}

; See Nerd Fonts nf-md-wifi_*
ramp-signal-0 = Û∞§Ø
ramp-signal-1 = Û∞§ü
ramp-signal-2 = Û∞§¢
ramp-signal-3 = Û∞§•
ramp-signal-4 = Û∞§®
ramp-signal-5 = Û∞§®

ramp-signal-foreground = ${colors.teal}

animation-packetloss-0 = Û∞§´
animation-packetloss-0-foreground = #ffa64c
animation-packetloss-1 = Û∞§©
animation-packetloss-1-foreground = #000000

; Framerate is in millis
animation-packetloss-framerate = 500


[module/battery]
type = internal/battery
battery = BAT0
adapter = ADP1
full-at = 100
format-charging = ÔÉß <label-charging>
label-charging = %percentage:2%%
format-charging-padding = 1
format-charging-foreground = ${colors.foreground}
format-discharging = <ramp-capacity><label-discharging>
label-discharging = %percentage%%
format-discharging-foreground = ${colors.mauve}
format-full-prefix = "ÔâÄ  "
ramp-capacity-0 = "ÔâÑ  "
ramp-capacity-1 = "ÔâÉ  "
ramp-capacity-2 = "ÔâÇ  "
ramp-capacity-3 = "ÔâÅ  "
ramp-capacity-4 = "ÔâÄ  "
ramp-capacity-0-foreground = ${colors.mauve}
animation-charging-framerate = 60
format-discharging-padding = 1

[module/date]
type = internal/date
interval = 1

; See [https://en.cppreference.com/w/cpp/io/manip/put_time] for escape codes
date = %H:%M  |  %d/%m %Y
date-alt = %r %a

label = %date%
label-foreground = ${colors.primary}

[settings]
screenchange-reload = true
pseudo-transparency = true


[module/powermenu]
type = custom/menu
expand-right = false
format-spacing = 2
label-open = "Û∞çú "
label-close = "Û∞çú "
label-separator = ""
label-separator-foreground = ${colors.blue}
menu-0-0 = "Ó´í"
menu-0-0-exec = reboot
menu-0-1 = "‚èª"
menu-0-1-exec = poweroff
menu-0-2 = "ÔÜÜ"
menu-0-2-exec = systemctl suspend & slock
; menu-0-3 = "ÔÆÆ"
; menu-0-3-exec = kitty -e neofetch

; Used to display the state of random/repeat/repeatone/single
; Only applies if <icon-[random|repeat|repeatone|single]> is used
toggle-on-foreground = #ff
toggle-off-foreground = #55

; Only applies if <bar-progress> is used
bar-progress-width = 45
bar-progress-indicator = |
bar-progress-fill = ‚îÄ
bar-progress-empty = ‚îÄ

[module/cava]
type = custom/script
tail = true
exec = . ~/.config/polybar/scripts/polybar-cava/cava.sh
; format-background = ${colors.base}
format = ‚ù¨<label>‚ù≠
label = %output%
label-font = 2
label-foreground = ${colors.primary}

[module/timer]
type = custom/script

exec = polybar-timer tail 'ÔÅÜ ' 0.5
tail = true

; polybar-timer update %pid%
click-left = polybar-timer new 25 'Û∞Öí ' 'Û∞è§ ' 'notify-send "Session finished"'
; polybar-timer update %pid%
click-middle = polybar-timer cancel
; polybar-timer update %pid%
click-right = polybar-timer togglepause
; polybar-timer update %pid%
scroll-up = polybar-timer increase 60 || polybar-timer new 1 'Û∞Öí ' 'Û∞è§ ' 'notify-send -u critical "Timer expired"'
; polybar-timer update %pid%
scroll-down = polybar-timer increase -60

[module/espr]
type = custom/script
exec = python3 ~/.config/polybar/scripts/espr/espr.py "‚ö° <when> | NEXT: <next>"
interval = 60

; [module/redshift]
; type = custom/script
; format-prefix = "ÔÉ´ "  
; exec = . ~/.config/polybar/scripts/redshift/env.sh && ~/.config/polybar/scripts/redshift/redshift.sh temperature 
; click-left = . ~/.config/polybar/scripts/redshift/env.sh && ~/.config/polybar/scripts/redshift/redshift.sh toggle 
; scroll-up = . ~/.config/polybar/scripts/redshift/env.sh && ~/.config/polybar/scripts/redshift/redshift.sh increase
; scroll-down = . ~/.config/polybar/scripts/redshift/env.sh && ~/.config/polybar/scripts/redshift/redshift.sh decrease
; interval=1

; [module/mpd]
; type = internal/mpd

; host = 127.0.0.1
; port = 6600
; password = password

; interval = 1

; format-online = <icon-prev> <icon-seekb> <icon-stop> <toggle> <icon-seekf> <icon-next>  <icon-repeat> <icon-random>  <bar-progress> <label-time>  <label-song>

; label-song = ùÑû %artist% - %title%

; label-offline = üéú mpd is offline

; ; Only applies if <icon-X> is used
; icon-play = Ó¨¨
; icon-pause = Ó´ë
; icon-stop = Ó´ó
; icon-prev = Û∞íÆ
; icon-next = Û∞í≠
; icon-seekb = Û∞ëü ;Û∞ÑΩ
; icon-seekf = Û∞àë ;Û∞Ñæ
; icon-random = ÔÅ¥
; icon-repeat = Û∞ëñ
; icon-repeatone = Û∞ëò
; icon-single = Û∞ëò
; icon-consume = Û∞ú∫

;-------------------------
; Catppuccin Mocha Palette
; Maintainer: justTOBBI
;--------------------------

[colors]
base = #1e1e2e
mantle = #181825
crust = #11111b

text = #cdd6f4
subtext0 = #a6adc8
subtext1 = #bac2de

surface0 = #313244
surface1 = #45475a
surface2 = #585b70

overlay0 = #6c7086
overlay1 = #7f849c
overlay2 = #9399b2


blue = #89b4fa
lavender = #b4befe
sapphire = #74c7ec
sky = #89dceb
teal = #94e2d5
green = #a6e3a1
yellow = #f9e2af
peach = #fab387
maroon = #eba0ac
red = #f38ba8
mauve = #cba6f7
pink = #f5c2e7
flamingo = #f2cdcd
rosewater = #f5e0dc

transparent = #FF00000

background = ${colors.base}
background-alt = ${colors.mantle}
foreground = ${colors.text}
primary = #f43e5c
secondary = #150a8f
alert = #A54242

disabled = #707880